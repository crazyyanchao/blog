---
title: 虚拟图ID系统相关存储过程实现
tags: [ONgDB,Cypher,Neo4j]
author: Yc-Ma
show_author_profile: true
key: 2021-04-07-虚拟图ID系统相关存储过程实现
pageview: true
---

Here's the table of contents:
1. TOC
{:toc}

## 虚拟图ID系统需要的函数如下
- 全局唯一ID表【使用MySQL实现】【根据查询性能考虑是否使用ES】【数据量可能会在千百亿】【用途：合并子图数据时使用的ID系统】
```
核心字段：
自增ID，限制字段
```
```
// 节点ID表
输入：节点ID
返回：返回一个自增ID【虚拟图需要的自增ID】
数据存储在MySQL-ONGDB_UNIQUE_WITH_AUTO_NODE_ID
数据写入逻辑：INSERT IGNORED
函数：RETURN custom.auto.node.id('HORG20f2833a17034a812349e1933d9c5e5f') AS nodeVAutoId
```
```
// 关系ID表
输入：主节点ID，关系类型，从节点ID
返回：返回一个自增ID
数据存储在MySQL-ONGDB_UNIQUE_WITH_AUTO_REL_ID
数据写入逻辑：INSERT IGNORED
函数：RETURN custom.auto.rel.id('HORG20f2833a17034a812349e1933d9c5e5f','担保','HORGa334e4057b12f53499c93d483c426993') AS relVAutoId
```

## 函数实现
- 获取虚拟图的节点自增ID
```
// RETURN custom.auto.node.id('HORG20f2833a17034a812349e1933d9c5e5f') AS nodeVAutoId
```
- 获取虚拟图的关系自增ID
```
// RETURN custom.auto.rel.id('HORG20f2833a17034a812349e1933d9c5e5f','担保','HORGa334e4057b12f53499c93d483c426993') AS relVAutoId
```

